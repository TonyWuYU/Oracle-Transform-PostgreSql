CREATE OR REPLACE 
FUNCTION        F_GET_VIP_SNAPSHOT (AS_COMM_ID VARCHAR2,AS_USER_ID VARCHAR2,ADATE DATE)
RETURN VARCHAR2
IS
 
LS_STATUS varchar2 (32);

begin
  
  SELECT STATUS INTO LS_STATUS FROM (
  select a.status FROM O2O_VIP_AUTH_LOG a
  WHERE a.COMM_ID=AS_COMM_ID AND a.V3_USER_ID=AS_USER_ID AND a.OPERATION_DATE<ADATE
  ORDER BY a.OPERATION_DATE desc 
  )WHERE ROWNUM=1;

return LS_STATUS;

end  F_GET_VIP_SNAPSHOT;
